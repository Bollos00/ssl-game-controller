<template>
    <div class="control-team">
        <span v-b-tooltip.hover
              :title="'Prepare for a kickoff (' + Object.keys(keymapKickoff)[0] + ')'">
        <b-button v-hotkey="keymapKickoff"
                  v-on:click="send('kickoff')"
                  v-bind:disabled="halted || running || preparing">
            Kickoff
        </b-button>
        </span>
        <span v-b-tooltip.hover
              :title="'Perform direct kick (corner and goal kicks) (' + Object.keys(keymapDirect)[0] + ')'">
        <b-button v-hotkey="keymapDirect"
                  v-on:click="send('direct')"
                  v-bind:disabled="halted || running || preparing || !nonPausedStage">
            Direct
        </b-button>
        </span>
        <span v-b-tooltip.hover
              :title="'Perform indirect kick (throw-in) (' + Object.keys(keymapIndirect)[0] + ')'">
        <b-button v-hotkey="keymapIndirect"
                  v-on:click="send('indirect')"
                  v-bind:disabled="halted || running || preparing || !nonPausedStage">
            Indirect
        </b-button>
        </span>
        <span v-b-tooltip.hover
              title="Prepare for a penalty kick">
        <b-button v-on:click="send('penalty')"
                  v-bind:disabled="halted || running || preparing || !nonPausedStage">
            Penalty
        </b-button>
        </span>

        <br/>

        <ControlTeamTimeout :team-color="teamColor"/>
        <b-button v-on:click="addGoal">
            Goal
        </b-button>
        <b-button v-on:click="addYellowCard"
                  v-hotkey="keymapYellowCard">
            Yellow Card
        </b-button>

        <br/>

        <b-button v-on:click="revokeYellowCard"
                  v-bind:disabled="teamState.yellowCardTimes.length===0">
            Revoke Yellow Card
        </b-button>
    </div>
</template>

<script>
    import ControlTeamTimeout from "./ControlTeamTimeout";
    import {isNonPausedStage} from "../../refereeState";

    export default {
        name: "ControlTeam",
        components: {ControlTeamTimeout},
        props: {
            teamColor: String
        },
        methods: {
            send: function (command) {
                this.$socket.sendObj({
                    'command': {'forTeam': this.teamColor, 'commandType': command}
                })
            },
            addYellowCard: function () {
                this.$socket.sendObj({'card': {'forTeam': this.teamColor, 'cardType': 'yellow', 'operation': 'add'}})
            },
            revokeYellowCard: function () {
                this.$socket.sendObj({'card': {'forTeam': this.teamColor, 'cardType': 'yellow', 'operation': 'revoke'}})
            },
            addGoal: function () {
                this.$socket.sendObj({'modify': {'forTeam': this.teamColor, 'goals': this.teamState.goals + 1}})
            },
        },
        computed: {
            teamState: function () {
                return this.$store.state.refBoxState.teamState[this.teamColor]
            },
            keymapKickoff() {
                if (this.teamColor === 'Yellow') {
                    return {'numpad 1': () => this.send('kickoff')};
                } else if (this.teamColor === 'Blue') {
                    return {'numpad 3': () => this.send('kickoff')};
                }
            },
            keymapDirect() {
                if (this.teamColor === 'Yellow') {
                    return {'numpad 7': () => this.send('direct')};
                } else if (this.teamColor === 'Blue') {
                    return {'numpad 9': () => this.send('direct')};
                }
            },
            keymapIndirect() {
                if (this.teamColor === 'Yellow') {
                    return {'numpad 4': () => this.send('indirect')};
                } else if (this.teamColor === 'Blue') {
                    return {'numpad 6': () => this.send('indirect')};
                }
            },
            keymapYellowCard() {
                switch (this.teamColor) {
                    case 'Yellow':
                        return {'numpad 4': this.addYellowCard};
                    case 'Blue':
                        return {'numpad 6': this.addYellowCard};
                }
            },
            state() {
                return this.$store.state.refBoxState
            },
            halted() {
                return this.state.command === 'halt';
            },
            running() {
                return this.state.command === 'forceStart'
                    || this.state.command === 'normalStart'
                    || this.state.command === 'direct'
                    || this.state.command === 'indirect';
            },
            preparing() {
                return this.state.command === 'kickoff' || this.state.command === 'penalty';
            },
            nonPausedStage() {
                return isNonPausedStage(this.state);
            },
        }
    }
</script>

<style scoped>
    button {
        margin: 0.5em;
    }
</style>